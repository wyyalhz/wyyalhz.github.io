var G=Object.defineProperty;var q=(t,e,i)=>e in t?G(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var g=(t,e,i)=>(q(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();function S(t){throw new Error("[PlayerCore error]: "+t)}function E(t){console.warn("[PlayerCore warn]: "+t)}function z(t){typeof t>"u"&&S("Expect other value but got undefined")}class Q{constructor(e){g(this,"e");g(this,"SongIdList");g(this,"CurrentSongId");g(this,"IsPlaying");g(this,"SongIdMap");g(this,"PlayMode");g(this,"IsMute");this.e=document.createElement("audio"),this.e.volume=.1,this.SongIdList=[],this.SongIdMap={},this.PlayMode=1,this.CurrentSongId="?",this.IsPlaying=!1,this.IsMute=!1}_AppendSongByIndex(e,i){this.SongIdList.splice(i,0,e.id),this.SongIdMap[e.id.toString()]=e}_AppendCheck(e){e?(this.SongIdList.indexOf(e.id)!==-1||this.SongIdMap[e.id])&&S("The song which append to queue has repeat id."):S("AppendSong function had been call but without song info.")}QuerySongInfo(e){return this.SongIdMap[e.toString()]}RemoveSong(e){z(e);const i=this.QuerySongInfo(e);if(i){if(this.CurrentSongId===i.id)if(this.SongIdList.length===1)this.e.pause(),this.e.src="",this.CurrentSongId="?";else{let r=this.SongIdList.indexOf(i.id);r===this.SongIdList.length-1?r=0:r++;const o=this.SongIdMap[this.SongIdList[r]];o&&(this.CurrentSongId=o.id,this.e.src=o.src)}delete this.SongIdMap[i.id],this.SongIdList.splice(this.SongIdList.indexOf(i.id),1)}}AppendSong(e,i){this._AppendCheck(e);let r=this.SongIdList.length;if(typeof i=="string"){const o=this.QuerySongInfo(i);if(o){const n=this.SongIdList.indexOf(o.id);n<r&&n>=0&&(r=n+1)}}this._AppendSongByIndex(e,r)}AppendSongOnHead(e){this._AppendCheck(e),this._AppendSongByIndex(e,-1)}AppendSongOnTail(e){this._AppendCheck(e),this._AppendSongByIndex(e,this.SongIdList.length)}AppendSongList(e){e.forEach(i=>{this.AppendSongOnTail(i)})}UpdateSongPosition(e){e.length!=this.SongIdList.length&&S("Update Song Position size is not equal with old list size");const i=new Set(this.SongIdList.map(r=>r));if(e.forEach(r=>{i.delete(r)}),i.size){const r=[];i.forEach(o=>{r.push(o)}),S("New list has unknown id: "+r.toString())}this.SongIdList=e}PlaySelectSong(e){const i=this.SongIdMap[e];if(this.SongIdList.indexOf(e)===-1){E(`Song's id: '${e}' is not in the id list or it's not corrent number.`);return}i&&(this.e.src=i.src,this.CurrentSongId=e),this.Play()}NextSong(){const e=this.SongIdList.indexOf(this.CurrentSongId);let i=0;e!==this.SongIdList.length-1&&(i=e+1),this.PlaySelectSong(this.SongIdList[i])}PrevSong(){const e=this.SongIdList.indexOf(this.CurrentSongId);let i=this.SongIdList.length-1;e!==0&&(i=e-1),this.PlaySelectSong(this.SongIdList[i])}SwitchMute(){this.IsMute=!this.e.muted,this.e.muted=this.IsMute}SwitchPlayMode(e){let i=1;typeof e=="object"&&(i=parseInt(e.currentTarget.getAttribute("data-mode-id"))),i===4?i=1:i++,this.PlayMode=i}async Play(){this.e.src.length===0&&this.PlaySelectSong(this.SongIdList[0]),await this.e.play(),this.IsPlaying=!0}Pause(){this.e.pause(),this.IsPlaying=!1}ChangeVolume(e){e<0&&e<=1?this.e.volume=0:e>1?this.e.volume=1:this.e.volume=e}ChangeCurrentSongTime(e){if(typeof e!="number"){E("Type of time expect number but got: "+typeof e);return}this.e.currentTime=e}}var b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var M=V,Y=typeof b=="object"&&b&&b.Object===Object&&b,K=Y,Z=K,J=typeof self=="object"&&self&&self.Object===Object&&self,ee=Z||J||Function("return this")(),R=ee,te=R,ie=function(){return te.Date.now()},ne=ie,oe=/\s/;function re(t){for(var e=t.length;e--&&oe.test(t.charAt(e)););return e}var se=re,ae=se,de=/^\s+/;function ce(t){return t&&t.slice(0,ae(t)+1).replace(de,"")}var le=ce,ue=R,fe=ue.Symbol,U=fe,k=U,H=Object.prototype,he=H.hasOwnProperty,ge=H.toString,v=k?k.toStringTag:void 0;function pe(t){var e=he.call(t,v),i=t[v];try{t[v]=void 0;var r=!0}catch{}var o=ge.call(t);return r&&(e?t[v]=i:delete t[v]),o}var me=pe,ve=Object.prototype,Se=ve.toString;function ye(t){return Se.call(t)}var we=ye,O=U,be=me,Ie=we,Te="[object Null]",Le="[object Undefined]",$=O?O.toStringTag:void 0;function Pe(t){return t==null?t===void 0?Le:Te:$&&$ in Object(t)?be(t):Ie(t)}var Me=Pe;function _e(t){return t!=null&&typeof t=="object"}var Ce=_e,xe=Me,Ee=Ce,ke="[object Symbol]";function Oe(t){return typeof t=="symbol"||Ee(t)&&xe(t)==ke}var $e=Oe,je=le,j=M,Ae=$e,A=0/0,We=/^[-+]0x[0-9a-f]+$/i,Ne=/^0b[01]+$/i,Re=/^0o[0-7]+$/i,Ue=parseInt;function He(t){if(typeof t=="number")return t;if(Ae(t))return A;if(j(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=j(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=je(t);var i=Ne.test(t);return i||Re.test(t)?Ue(t.slice(2),i?2:8):We.test(t)?A:+t}var De=He,Be=M,L=ne,W=De,Xe="Expected a function",Fe=Math.max,Ge=Math.min;function qe(t,e,i){var r,o,n,s,a,c,d=0,u=!1,f=!1,p=!0;if(typeof t!="function")throw new TypeError(Xe);e=W(e)||0,Be(i)&&(u=!!i.leading,f="maxWait"in i,n=f?Fe(W(i.maxWait)||0,e):n,p="trailing"in i?!!i.trailing:p);function I(l){var h=r,m=o;return r=o=void 0,d=l,s=t.apply(m,h),s}function D(l){return d=l,a=setTimeout(w,e),u?I(l):s}function B(l){var h=l-c,m=l-d,x=e-h;return f?Ge(x,n-m):x}function _(l){var h=l-c,m=l-d;return c===void 0||h>=e||h<0||f&&m>=n}function w(){var l=L();if(_(l))return C(l);a=setTimeout(w,B(l))}function C(l){return a=void 0,p&&r?I(l):(r=o=void 0,s)}function X(){a!==void 0&&clearTimeout(a),d=0,r=c=o=a=void 0}function F(){return a===void 0?s:C(L())}function T(){var l=L(),h=_(l);if(r=arguments,o=this,c=l,h){if(a===void 0)return D(c);if(f)return clearTimeout(a),a=setTimeout(w,e),I(c)}return a===void 0&&(a=setTimeout(w,e)),s}return T.cancel=X,T.flush=F,T}var ze=qe,Qe=ze,Ve=M,Ye="Expected a function";function Ke(t,e,i){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(Ye);return Ve(i)&&(r="leading"in i?!!i.leading:r,o="trailing"in i?!!i.trailing:o),Qe(t,e,{leading:r,maxWait:e,trailing:o})}var Ze=Ke;const Je=t=>{const e=t.exp?document.querySelector(t.exp):t.el;if(!e)return;let i=0,r=0;const o=e.clientWidth;e.clientHeight;function n(c,d){e.style.setProperty("left",c+"px"),e.style.setProperty("top",d+"px")}const s=Ze(c=>{let d=c.clientX-i,u=c.clientY-r;const f=window.innerWidth,p=window.innerHeight;d<=-o?d=-o:d+e.offsetWidth>=f+o&&(d=f+o-e.offsetWidth),u<=0?u=0:u+e.offsetHeight>=p&&(u=p-e.offsetHeight),n(d,u)},16);function a(){window.removeEventListener("mousemove",s)}return t.el.addEventListener("mousedown",c=>{i=c.clientX-e.offsetLeft,r=c.clientY-e.offsetTop;function d(){a(),window.removeEventListener("mouseup",d)}window.addEventListener("mousemove",s),window.addEventListener("mouseup",d)}),()=>{}};const N=/left|right/,et=t=>{const e=t.el,i=()=>{var r,o;e.offsetLeft>window.innerWidth/2?(e.setAttribute("class",`${(r=e.getAttribute("class"))==null?void 0:r.replace(N,"")} right`),e.style.setProperty("left",window.innerWidth-e.clientWidth+"px")):(e.setAttribute("class",`${(o=e.getAttribute("class"))==null?void 0:o.replace(N,"")} left`),e.style.setProperty("left","0px"))};return window.addEventListener("mouseup",()=>setTimeout(()=>{i()},20)),window.addEventListener("resize",i),()=>{}};function P(t){t||(t=0);let e=parseInt(t/60+""),i=parseInt(t%60+"");return e<10&&(e="0"+e),i<10&&(i="0"+i),`${e}:${i}`}const tt=`<div v-scope id="CoreWrapper" v-wrapper-adsorb @mouseup="wrapperMouseUp"@mousedown="clearHiddenTimer" @vue:mounted="onMounted" :class="\`player_module \${dragging ? 'dragging': ''} \${onRight ? 'right' : 'left'} \${hidden && !hover ? 'hidden' : ''}\`"><div class="left_arrow" @click="clickShow"><i class="iconfont icon-24gl-arrowLeft3"></i></div><div class="operate_box" @mousedown="wrapperMouseDown" @mouseenter="wrapperMouseEnter"@mouseleave="wrapperMouseLeave"><div class="left_img" :style="\`background-image: url(\${currentSongInfo.img ? currentSongInfo.img  : './src/assets/icon.jpg'});\`"></div><div class="right_operate"><div class="song_name" v-draggable="#CoreWrapper"><span class="name">{{ currentSongInfo.name }}</span><span class="time">{{ mediaCurrentTime }}/{{ mediaDuration }}</span></div><div class="operation_button"><i class="iconfont icon-24gl-volumeZero" v-if="store.IsMute" @click="store.SwitchMute"></i><i class="iconfont icon-24gl-volumeMiddle" v-else @click="store.SwitchMute"></i><i class="iconfont icon-24gl-previousCircle" @click="store.PrevSong"></i><i class="iconfont icon-24gl-pauseCircle" v-if="store.IsPlaying" @click="CorePause"></i><i class="iconfont icon-24gl-playCircle" v-else @click="CorePlay"></i><i class="iconfont icon-24gl-nextCircle" @click="store.NextSong"></i><i class="iconfont icon-24gl-arrowRight" v-if="store.PlayMode === 1" data-mode-id="1"@click="store.SwitchPlayMode"></i><i class="iconfont icon-24gl-repeat2" v-else-if="store.PlayMode === 2"data-mode-id="2" @click="store.SwitchPlayMode"></i><i class="iconfont icon-24gl-repeatOnce2" v-else-if="store.PlayMode === 3"data-mode-id="3" @click="store.SwitchPlayMode"></i><i class="iconfont icon-24gl-shuffle" v-else @click="store.SwitchPlayMode"data-mode-id="4"></i></div><div class="slider" @click.stop.prevent><div class="track" @mousedown="jumpTime"><div class="active_track" :style="\`width: \${showupPrecentage}%;\`"></div></div><div class="thumb" :style="\`left: \${showupPrecentage}%;\`"></div></div></div></div><div class="right_arrow" @click="clickShow"><i class="iconfont icon-24gl-arrowRight3"></i></div><div class="show_list_button" @click="switchListShow"></div><div :class="\`list_box player_module \${showList ? 'show' : ''}\`" @mouseenter="wrapperMouseEnter"@mouseleave="wrapperMouseLeave"><div class="empty_tips" v-if="store.SongIdList.length === 0">No Data :(</div><div :class="\`song_item \${i.id === store.CurrentSongId ? 'current' : ''}\`"v-for="(i, index) in songInfoList" @dblclick="CorePlaySelectSong(i.id)"><div class="title">{{ i.name }}</div><div class="function_button"><i class="iconfont icon-24gl-playCircle" @click="store.PlaySelectSong(i.id)"></i><i class="iconfont icon-24gl-trash2" @click="store.RemoveSong(i.id)"></i></div></div></div></div>`;(function(){const t="CoreWrapper",e=PetiteVue.reactive(new Q({}));window._PlayerCore=e,console.log("Vue-Mini-Player powered by: https://github.com/QingXia-Ela/vue-mini-player");const i=document.createElement("div");i.setAttribute("id","CorePlayer"),i.innerHTML=tt,document.body.appendChild(i);let r;const o=PetiteVue.createApp({store:e,dragging:!1,onRight:!1,hidden:!0,hover:!1,currentTime:0,duration:0,showupPrecentage:0,showList:!1,sliding:!1,slidingTime:0,onMounted(){const{e:n}=e;n.addEventListener("timeupdate",()=>{this.sliding||(this.CurrentTime=n.currentTime,this._UpdateShowPrecentage(this.CurrentTime/this.duration))}),n.addEventListener("loadedmetadata",()=>{this.sliding||(this.duration=n.duration)}),this.store.e.addEventListener("ended",()=>{const{SongIdList:s,CurrentSongId:a,PlayMode:c}=this.store,d=s.indexOf(a);switch(c){case 1:d!==s.length&&e.NextSong();break;case 2:e.NextSong();break;case 3:e.Play();break;case 4:let u=parseInt(s.length*Math.random()+"");for(;u===a;)u=parseInt(s.length*Math.random()+"");e.PlaySelectSong(s[u]);break;default:e.NextSong();break}})},get currentPrecentage(){return(this.currentTime*100).toFixed(2)},get currentSongInfo(){const n=e.SongIdMap[e.CurrentSongId];return n||{name:"_(:\u0437\u300D\u2220)_"}},get mediaDuration(){return P(this.duration)},get mediaCurrentTime(){return this.sliding?P(this.slidingTime):P(this.CurrentTime)},get songInfoList(){const n=[];for(const s of e.SongIdList)n.push(e.SongIdMap[s]);return n},clearHiddenTimer(){clearTimeout(r)},startTimer(){r&&this.clearHiddenTimer(),r=setTimeout(()=>{this.hidden=!0,this.hover=!1,this.showList=!1,this.clearHiddenTimer()},8e3)},wrapperMouseDown(){this.dragging=!0,this.hidden=!1},wrapperMouseUp(){this.dragging=!1;const n=document.getElementById(t);n&&(n.offsetLeft>window.innerWidth/2?this.onRight=!0:this.onRight=!1)},wrapperMouseEnter(){this.hover=!0,this.clearHiddenTimer()},wrapperMouseLeave(){this.hover=!1,this.startTimer()},clickShow(n){clearTimeout(r),this.hidden=!this.hidden,this.hidden&&(this.showList=!1),n.preventDefault(),this.startTimer()},_UpdateShowPrecentage(n){n>1?n=1:n<0&&(n=0),this.showupPrecentage=(n*100).toFixed(2),this.slidingTime=this.duration*n},jumpTime(n){if(isNaN(this.store.e.duration))return;const s=n.currentTarget;let a=n.offsetX/s.clientWidth;this._UpdateShowPrecentage(a),this.sliding=!0,a*=s.clientWidth;const c=u=>{const f=document.getElementById(t);a=u.clientX-f.offsetLeft-s.clientWidth,a+=this.onRight?25:85,this._UpdateShowPrecentage(a/s.clientWidth)},d=()=>{this.store.e.currentTime=a/s.clientWidth*this.duration,this.sliding=!1,window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)},switchListShow(){this.showList=!this.showList},async CorePlay(){try{await e.Play()}catch(n){console.log(n)}},CorePause(){e.Pause()},CorePlaySelectSong(n){e.PlaySelectSong(n)}});o.directive("draggable",Je),o.directive("wrapper-adsorb",et),o.mount("#CorePlayer")})();const y=window._PlayerCore;y.AppendSong({name:"Infected",id:2,src:"https://shiinafan.top/static/sample.mp3",img:"./vite copy.svg"});y.AppendSong({name:"olk",id:8,src:"https://shiinafan.top/static/sample2.mp3",img:"https://shiinafan.top/favicon.ico"});y.AppendSong({name:"Untitled World",id:0,src:"https://shiinafan.top/static/sample3.mp3",img:"https://shiinafan.top/favicon.ico"});y.e.addEventListener("ended",t=>{console.log("end")});console.log(y.SongIdMap);
